{% extends "base.html" %}

{% block content %}
{% set recipes = section.pages | sort(attribute="title") %}

<section class="hero">
    <a class="ghost" href="{{ get_url(path='') }}">‚Üê Back home</a>
    <h1>{{ section.title }}</h1>
    {% if section.description %}
        <p class="lede">{{ section.description }}</p>
    {% endif %}
    <div class="meta-row">
        <span class="pill subtle">{{ recipes | length }} recipes</span>
    </div>
</section>

{% if section.content %}
    <section class="content">
        {{ section.content | safe }}
    </section>
{% endif %}

<section class="search-panel" id="recipes">
    <div class="search-header">
        <div>
            <p class="eyebrow">Recipe catalog</p>
            <h2>Browse everything</h2>
            <p class="lede">Filter by name, ingredient, or tag to jump straight to a dish.</p>
        </div>
        <label class="search-box" for="recipe-search">
            <span class="label">Search recipes</span>
            <input id="recipe-search" type="search" placeholder="e.g., pancakes, banana, quick bread" autocomplete="off">
        </label>
    </div>

    <div class="recipe-grid" id="recipe-grid">
        {% for recipe in recipes %}
            {% set tags = recipe.extra.tags | default(value=[]) %}
            {% set description = recipe.description | default(value="") %}
            {% set searchable_tags = tags | join(sep=" ") %}
            {% set search_text = [recipe.title, description, searchable_tags] | join(sep=" ") | lower %}
            <article class="recipe-card" data-search="{{ search_text }}">
                {% if recipe.extra.time %}
                    <p class="eyebrow">{{ recipe.extra.time }}</p>
                {% endif %}
                <h3><a href="{{ recipe.permalink }}">{{ recipe.title }}</a></h3>
                {% if recipe.description %}
                    <p class="card-desc">{{ recipe.description }}</p>
                {% endif %}
                <div class="meta-row">
                    {% if recipe.extra.yield %}
                        <span class="pill">{{ recipe.extra.yield }}</span>
                    {% endif %}
                    {% for tag in tags %}
                        <span class="pill subtle">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% if recipe.extra.source %}
                    <p class="source-link">Source: <a href="{{ recipe.extra.source }}" target="_blank" rel="noopener">{{ recipe.extra.source }}</a></p>
                {% endif %}
            </article>
        {% endfor %}
        {% if recipes | length == 0 %}
            <p class="empty">No recipes have been added yet. Check back soon!</p>
        {% endif %}
    </div>
</section>

<script>
    const searchInput = document.getElementById('recipe-search');
    const cards = Array.from(document.querySelectorAll('.recipe-card'));
    const grid = document.getElementById('recipe-grid');

    function filterRecipes() {
        const query = searchInput.value.trim().toLowerCase();
        let matches = 0;

        cards.forEach(card => {
            const text = card.dataset.search;
            const isMatch = text.includes(query);
            card.style.display = isMatch ? '' : 'none';
            if (isMatch) matches += 1;
        });

        grid.classList.toggle('no-results', matches === 0);
    }

    searchInput.addEventListener('input', filterRecipes);
</script>
{% endblock content %}
